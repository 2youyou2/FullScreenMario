var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},UserWrappr;(function(n){"use strict";var i=function(){function n(n){this.documentElement=document.documentElement;this.requestFullScreen=(this.documentElement.requestFullScreen||this.documentElement.webkitRequestFullScreen||this.documentElement.mozRequestFullScreen||this.documentElement.msRequestFullscreen||function(){console.warn("Not able to request full screen...")}).bind(this.documentElement);this.cancelFullScreen=(this.documentElement.cancelFullScreen||this.documentElement.webkitCancelFullScreen||this.documentElement.mozCancelFullScreen||this.documentElement.msCancelFullScreen||function(){console.warn("Not able to cancel full screen...")}).bind(document);this.customs=n.customs||{};this.GameStartrConstructor=n.GameStartrConstructor;this.settings=n;this.helpSettings=this.settings.helpSettings;this.globalName=n.globalName;this.importSizes(n.sizes);this.gameNameAlias=this.helpSettings.globalNameAlias||"{%%%%GAME%%%%}";this.gameElementSelector=n.gameElementSelector||"#game";this.gameControlsSelector=n.gameControlsSelector||"#controls";this.log=n.log||console.log.bind(console);this.isFullScreen=!1;this.setCurrentSize(this.sizes[n.sizeDefault]);this.allPossibleKeys=n.allPossibleKeys||["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","up","right","down","left","space","shift","ctrl"];this.GameStartrConstructor.prototype.proliferate(this.customs,this.currentSize,!0);this.resetGameStarter(n,this.customs)}return n.prototype.resetGameStarter=function(n,t){t===void 0&&(t={});this.loadGameStarter(this.fixCustoms(t||{}));window[n.globalName||"GameStarter"]=this.GameStarter;this.GameStarter.UserWrapper=this;this.loadGenerators();this.loadControls(n.schemas);n.styleSheet&&this.GameStarter.addPageStyles(n.styleSheet);this.resetPageVisibilityHandlers();this.GameStarter.gameStart()},n.prototype.getGameStartrConstructor=function(){return this.GameStartrConstructor},n.prototype.getGameStarter=function(){return this.GameStarter},n.prototype.getStatsHolder=function(){return this.StatsHolder},n.prototype.getSettings=function(){return this.settings},n.prototype.getCustoms=function(){return this.customs},n.prototype.getHelpSettings=function(){return this.helpSettings},n.prototype.getGlobalName=function(){return this.globalName},n.prototype.getGameNameAlias=function(){return this.gameNameAlias},n.prototype.getAllPossibleKeys=function(){return this.allPossibleKeys},n.prototype.getSizes=function(){return this.sizes},n.prototype.getCurrentSize=function(){return this.currentSize},n.prototype.getIsFullScreen=function(){return this.isFullScreen},n.prototype.getIsPageHidden=function(){return this.isPageHidden},n.prototype.getLog=function(){return this.log},n.prototype.getGenerators=function(){return this.generators},n.prototype.getDocumentElement=function(){return this.documentElement},n.prototype.getRequestFullScreen=function(){return this.requestFullScreen},n.prototype.getCancelFullScreen=function(){return this.cancelFullScreen},n.prototype.setCurrentSize=function(n){if(typeof n=="string"||n.constructor===String){if(!this.sizes.hasOwnProperty(n))throw new Error("Size "+n+" does not exist on the UserWrappr.");n=this.sizes[n]}this.customs=this.fixCustoms(this.customs);n.full?(this.requestFullScreen(),this.isFullScreen=!0):this.isFullScreen&&(this.cancelFullScreen(),this.isFullScreen=!1);this.currentSize=n;this.GameStarter&&(this.GameStarter.container.parentNode.removeChild(this.GameStarter.container),this.resetGameStarter(this.settings,this.customs))},n.prototype.displayHelpMenu=function(){this.helpSettings.openings.forEach(this.logHelpText.bind(this))},n.prototype.displayHelpOptions=function(){this.logHelpText("To focus on a group, enter `"+this.globalName+'.UserWrapper.displayHelpOption("<group-name>");`');Object.keys(this.helpSettings.options).forEach(this.displayHelpGroupSummary.bind(this));this.logHelpText("\nTo focus on a group, enter `"+this.globalName+'.UserWrapper.displayHelpOption("<group-name>");`')},n.prototype.displayHelpGroupSummary=function(n){var i=this.helpSettings.options[n],r,u=0,t;for(this.log("\n"+n),t=0;t<i.length;t+=1)u=Math.max(u,this.filterHelpText(i[t].title).length);for(t=0;t<i.length;t+=1)r=i[t],this.log(this.padTextRight(this.filterHelpText(r.title),u)+" ... "+r.description)},n.prototype.displayHelpOption=function(n){for(var e=this.helpSettings.options[n],t,r,u,i,f=0;f<e.length;f+=1){if(t=e[f],u=0,this.logHelpText(t.title+" -- "+t.description),t.usage&&this.logHelpText(t.usage),t.examples){for(i=0;i<t.examples.length;i+=1)r=t.examples[i],u=Math.max(u,this.filterHelpText("    "+r.code).length);for(i=0;i<t.examples.length;i+=1)r=t.examples[i],this.logHelpText(this.padTextRight(this.filterHelpText("    "+r.code),u)+"  // "+r.comment)}this.log("\n")}},n.prototype.logHelpText=function(n){this.log(this.filterHelpText(n))},n.prototype.filterHelpText=function(n){return n.replace(new RegExp(this.gameNameAlias,"g"),this.globalName)},n.prototype.padTextRight=function(n,t){var i=1+t-n.length;return i<=0?n:n+Array.call(Array,i).join(" ")},n.prototype.importSizes=function(n){var t;this.sizes=this.GameStartrConstructor.prototype.proliferate({},n);for(t in this.sizes)this.sizes.hasOwnProperty(t)&&(this.sizes[t].name=this.sizes[t].name||t)},n.prototype.fixCustoms=function(n){var t=this.GameStartrConstructor.prototype.proliferate({},n);return this.GameStartrConstructor.prototype.proliferate(t,this.currentSize),isFinite(t.width)||(t.width=document.body.clientWidth),isFinite(t.height)||(t.height=t.full?screen.height:this.isFullScreen?window.innerHeight-140:window.innerHeight,t.height-=84),t},n.prototype.resetPageVisibilityHandlers=function(){document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this))},n.prototype.handleVisibilityChange=function(){switch(document.visibilityState){case"hidden":this.onPageHidden();return;case"visible":this.onPageVisible();return;default:return}},n.prototype.onPageHidden=function(){this.GameStarter.GamesRunner.getPaused()||(this.isPageHidden=!0,this.GameStarter.GamesRunner.pause())},n.prototype.onPageVisible=function(){this.isPageHidden&&(this.isPageHidden=!1,this.GameStarter.GamesRunner.play())},n.prototype.loadGameStarter=function(n){var t=document.querySelector(this.gameElementSelector);this.GameStarter&&this.GameStarter.GamesRunner.pause();this.GameStarter=new this.GameStartrConstructor(n);t.textContent="";t.appendChild(this.GameStarter.container);this.GameStarter.proliferate(document.body,{onkeydown:this.GameStarter.InputWriter.makePipe("onkeydown","keyCode"),onkeyup:this.GameStarter.InputWriter.makePipe("onkeyup","keyCode")});this.GameStarter.proliferate(t,{onmousedown:this.GameStarter.InputWriter.makePipe("onmousedown","which"),oncontextmenu:this.GameStarter.InputWriter.makePipe("oncontextmenu",null,!0)})},n.prototype.loadGenerators=function(){this.generators={OptionsButtons:new t.OptionsButtonsGenerator(this),OptionsTable:new t.OptionsTableGenerator(this),LevelEditor:new t.LevelEditorGenerator(this),MapsGrid:new t.MapsGridGenerator(this)}},n.prototype.loadControls=function(n){var i=document.querySelector(this.gameControlsSelector),r=n.length,t;for(this.StatsHolder=new StatsHoldr.StatsHoldr({prefix:this.globalName+"::UserWrapper::StatsHolder",proliferate:this.GameStarter.proliferate,createElement:this.GameStarter.createElement}),i.textContent="",i.className="length-"+r,t=0;t<r;t+=1)i.appendChild(this.loadControlDiv(n[t]))},n.prototype.loadControlDiv=function(n){var t=document.createElement("div"),r=document.createElement("h4"),i=document.createElement("div");return t.className="control",t.id="control-"+n.title,r.textContent=n.title,i.className="control-inner",i.appendChild(this.generators[n.generator].generate(n)),t.appendChild(r),t.appendChild(i),t.onmouseover=setTimeout.bind(undefined,function(){t.setAttribute("active","on")},35),t.onmouseout=function(){t.setAttribute("active","off")},t},n}(),t;n.UserWrappr=i,function(n){var t=function(){function n(n){this.UserWrapper=n;this.GameStarter=this.UserWrapper.getGameStarter()}return n.prototype.generate=function(){throw new Error("AbstractOptionsGenerator is abstract. Subclass it.");},n.prototype.getParentControlDiv=function(n){return n.className==="control"?n:n.parentNode?this.getParentControlDiv(n.parentElement):undefined},n.prototype.ensureLocalStorageValue=function(n,t,i){if(n.constructor===Array){this.ensureLocalStorageValues(n,t,i);return}var r=n,f=i.title+"::"+t.title,e=t.source.call(this,this.GameStarter).toString(),u;if(r.setAttribute("localStorageKey",f),this.GameStarter.StatsHolder.addItem(f,{storeLocally:!0,valueDefault:e}),u=this.GameStarter.StatsHolder.getItem(f),u!==""&&u!==r.value)if(r.value=u,r.setValue)r.setValue(u);else if(r.onchange)r.onchange(undefined);else if(r.onclick)r.onclick(undefined)},n.prototype.ensureLocalStorageValues=function(n,t,i){for(var o=i.title+"::"+t.title,s=t.source.call(this,this.GameStarter),f,e,r,u=0;u<n.length;u+=1)if(f=o+"::"+u,r=n[u],r.setAttribute("localStorageKey",f),this.GameStarter.StatsHolder.addItem(f,{storeLocally:!0,valueDefault:s[u]}),e=this.GameStarter.StatsHolder.getItem(f),e!==""&&e!==r.value)if(r.value=e,r.onchange)r.onchange(undefined);else if(r.onclick)r.onclick(undefined)},n.prototype.storeLocalStorageValue=function(n,t){var i=n.getAttribute("localStorageKey");i&&this.GameStarter.StatsHolder.setItem(i,t)},n}(),i,r,u,f;n.AbstractOptionsGenerator=t;i=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.generate=function(n){var r=document.createElement("div"),o=n.options instanceof Function?n.options.call(self,this.GameStarter):n.options,u=Object.keys(o),h=n.keyActive||"active",f="select-option options-button-option",e=this,s,t,i;for(r.className="select-options select-options-buttons",i=0;i<u.length;i+=1)s=o[u[i]],t=document.createElement("div"),t.className=f,t.textContent=u[i],t.onclick=function(n,t){e.getParentControlDiv(t).getAttribute("active")==="on"&&(n.callback.call(e,e.GameStarter,n,t),t.getAttribute("option-enabled")==="true"?(t.setAttribute("option-enabled","false"),t.className=f+" option-disabled"):(t.setAttribute("option-enabled","true"),t.className=f+" option-enabled"))}.bind(undefined,n,t),s[h]?(t.className+=" option-enabled",t.setAttribute("option-enabled","1")):n.assumeInactive?(t.className+=" option-disabled",t.setAttribute("option-enabled","0")):t.setAttribute("option-enabled","1"),r.appendChild(t);return r},t}(t);n.OptionsButtonsGenerator=i;r=function(n){function t(){n.apply(this,arguments);this.optionTypes={Boolean:this.setBooleanInput,Keys:this.setKeyInput,Number:this.setNumberInput,Select:this.setSelectInput,ScreenSize:this.setScreenSizeInput}}return __extends(t,n),t.prototype.generate=function(n){var u=document.createElement("div"),s=document.createElement("table"),r,o,t,f,e,h,i;if(u.className="select-options select-options-table",n.options)for(i=0;i<n.options.length;i+=1)t=document.createElement("tr"),f=document.createElement("td"),e=document.createElement("td"),r=n.options[i],f.className="options-label-"+r.type,f.textContent=r.title,e.className="options-cell-"+r.type,t.appendChild(f),t.appendChild(e),h=this.optionTypes[n.options[i].type].call(this,e,r,n),r.storeLocally&&this.ensureLocalStorageValue(h,r,n),s.appendChild(t);if(u.appendChild(s),n.actions)for(i=0;i<n.actions.length;i+=1)t=document.createElement("div"),o=n.actions[i],t.className="select-option options-button-option",t.textContent=o.title,t.onclick=o.action.bind(this,this.GameStarter),u.appendChild(t);return u},t.prototype.setBooleanInput=function(n,t){var r=t.source.call(this,this.GameStarter),u=r?"enabled":"disabled",i=this;return n.className="select-option options-button-option option-"+u,n.textContent=r?"on":"off",n.onclick=function(){n.setValue(n.textContent==="off")},n.setValue=function(r){r.constructor===String&&(r==="false"||r==="off"?r=!1:(r==="true"||r==="on")&&(r=!0));r?(t.enable.call(i,i.GameStarter),n.textContent="on",n.className=n.className.replace("disabled","enabled")):(t.disable.call(i,i.GameStarter),n.textContent="off",n.className=n.className.replace("enabled","disabled"));t.storeLocally&&i.storeLocalStorageValue(n,r.toString())},n},t.prototype.setKeyInput=function(n,t){for(var e=t.source.call(this,this.GameStarter),o=[],i,f=this,u,r=0;r<e.length;r+=1){for(i=document.createElement("select"),i.className="options-key-option",u=0;u<this.UserWrapper.getAllPossibleKeys().length;u+=1)i.appendChild(new Option(this.UserWrapper.getAllPossibleKeys()[u]));i.value=i.valueOld=e[r].toLowerCase();i.onchange=function(n){t.callback.call(f,f.GameStarter,n.valueOld,n.value);t.storeLocally&&f.storeLocalStorageValue(n,n.value)}.bind(undefined,i);o.push(i);n.appendChild(i)}return o},t.prototype.setNumberInput=function(n,t){var i=document.createElement("input"),r=this;return i.type="number",i.value=Number(t.source.call(r,r.GameStarter)).toString(),i.min=(t.minimum||0).toString(),i.max=(t.maximum||Math.max(t.minimum+10,10)).toString(),i.onchange=i.oninput=function(){i.checkValidity()&&t.update.call(r,r.GameStarter,i.value);t.storeLocally&&r.storeLocalStorageValue(i,i.value)},n.appendChild(i),i},t.prototype.setSelectInput=function(n,t){for(var i=document.createElement("select"),f=t.options(this.GameStarter),r=this,u=0;u<f.length;u+=1)i.appendChild(new Option(f[u]));return i.value=t.source.call(r,r.GameStarter),i.onchange=function(){t.update.call(r,r.GameStarter,i.value);i.blur();t.storeLocally&&r.storeLocalStorageValue(i,i.value)},n.appendChild(i),i},t.prototype.setScreenSizeInput=function(n,t,i){var r=this;return t.options=function(){return Object.keys(r.UserWrapper.getSizes())},t.source=function(){return r.UserWrapper.getCurrentSize().name},t.update=function(n,t){if(t===r.UserWrapper.getCurrentSize())return undefined;r.UserWrapper.setCurrentSize(t)},r.setSelectInput(n,t,i)},t}(t);n.OptionsTableGenerator=r;u=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.generate=function(){var n=document.createElement("div"),i=document.createElement("div"),t=document.createElement("div"),r=document.createElement("div"),u=this.createUploaderDiv(),f=this;return n.className="select-options select-options-level-editor",i.className="select-option-title",i.textContent="Create your own custom levels:",t.className="select-option select-option-large options-button-option",t.innerHTML="Start the <br /> Level Editor!",t.onclick=function(){f.GameStarter.LevelEditor.enable()},r.className="select-option-title",r.innerHTML="<em>- or -<\/em><br />",n.appendChild(i),n.appendChild(t),n.appendChild(r),n.appendChild(u),n},t.prototype.createUploaderDiv=function(){var n=document.createElement("div"),t=document.createElement("input");return n.className="select-option select-option-large options-button-option",n.textContent="Click to upload and continue your editor files!",n.setAttribute("textOld",n.textContent),t.type="file",t.className="select-upload-input",t.onchange=this.handleFileDrop.bind(this,t,n),n.ondragenter=this.handleFileDragEnter.bind(this,n),n.ondragover=this.handleFileDragOver.bind(this,n),n.ondragleave=t.ondragend=this.handleFileDragLeave.bind(this,n),n.ondrop=this.handleFileDrop.bind(this,t,n),n.onclick=t.click.bind(t),n.appendChild(t),n},t.prototype.handleFileDragEnter=function(n,t){t.dataTransfer&&(t.dataTransfer.dropEffect="copy");n.className+=" hovering"},t.prototype.handleFileDragOver=function(n,t){return t.preventDefault(),!1},t.prototype.handleFileDragLeave=function(n,t){t.dataTransfer&&(t.dataTransfer.dropEffect="none");n.className=n.className.replace(" hovering","")},t.prototype.handleFileDrop=function(n,t,i){var f=n.files||i.dataTransfer.files,r=f[0],u=new FileReader;this.handleFileDragLeave(n,i);i.preventDefault();i.stopPropagation();u.onprogress=this.handleFileUploadProgress.bind(this,r,t);u.onloadend=this.handleFileUploadCompletion.bind(this,r,t);u.readAsText(r)},t.prototype.handleFileUploadProgress=function(n,t,i){var r;i.lengthComputable&&(r=Math.round(i.loaded/i.total*100),r>100&&(r=100),t.innerText="Uploading '"+n.name+"' ("+r+"%)...")},t.prototype.handleFileUploadCompletion=function(n,t,i){this.GameStarter.LevelEditor.handleUploadCompletion(i);t.innerText=t.getAttribute("textOld")},t}(t);n.LevelEditorGenerator=u;f=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.generate=function(n){var t=document.createElement("div");return t.className="select-options select-options-maps-grid",n.rangeX&&n.rangeY&&t.appendChild(this.generateRangedTable(n)),n.extras&&this.appendExtras(t,n),t},t.prototype.generateRangedTable=function(n){for(var i=this,e=document.createElement("table"),o=n.rangeX,s=n.rangeY,r,t,f,u=s[0];u<=s[1];u+=1){for(r=document.createElement("tr"),r.className="maps-grid-row",f=o[0];f<=o[1];f+=1)t=document.createElement("td"),t.className="select-option maps-grid-option maps-grid-option-range",t.textContent=u+"-"+f,t.onclick=function(n){i.getParentControlDiv(t).getAttribute("active")==="on"&&n()}.bind(i,n.callback.bind(i,i.GameStarter,n,t)),r.appendChild(t);e.appendChild(r)}return e},t.prototype.appendExtras=function(n,t){var i,r,f,u;for(f in t.extras)if(t.extras.hasOwnProperty(f)&&(r=t.extras[f],i=document.createElement("div"),i.className="select-option maps-grid-option maps-grid-option-extra",i.textContent=r.title,i.setAttribute("value",r.title),i.onclick=r.callback.bind(this,this.GameStarter,t,i),n.appendChild(i),r.extraElements))for(u=0;u<r.extraElements.length;u+=1)n.appendChild(this.GameStarter.createElement.apply(this.GameStarter,r.extraElements[u]))},t}(t);n.MapsGridGenerator=f}(t=n.UISchemas||(n.UISchemas={}))})(UserWrappr||(UserWrappr={}));
//# sourceMappingURL=UserWrappr-0.2.0.min.js.map
